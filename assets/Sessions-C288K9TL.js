import{a as O,r,j as e}from"./index-DNxpbptG.js";const q=()=>{const{sessions:S,trainers:y,dispatchSessions:p,SESSION_ACTIONS:b,getTrainerById:v,checkSessionConflict:I}=O(),[w,l]=r.useState(!1),[i,j]=r.useState(null),[s,o]=r.useState({name:"",date:"",startTime:"",endTime:"",trainerId:""}),[a,x]=r.useState({}),[d,N]=r.useState(!1),[f,T]=r.useState(null),c=()=>{o({name:"",date:"",startTime:"",endTime:"",trainerId:""}),j(null),x({})},D=()=>{c(),l(!0)},E=t=>{o(t),j(t),l(!0)},C=()=>{const t={};return s.name.trim()?s.name.trim().length<3&&(t.name="Session name must be at least 3 characters"):t.name="Session name is required",s.trainerId||(t.trainerId="Trainer is required"),s.date||(t.date="Date is required"),s.startTime||(t.startTime="Start time is required"),s.endTime||(t.endTime="End time is required"),s.startTime&&s.endTime&&s.startTime>=s.endTime&&(t.endTime="End time must be after start time"),s.trainerId&&s.date&&s.startTime&&s.endTime&&I(s.trainerId,s.date,s.startTime,s.endTime,i==null?void 0:i.id)&&(t.trainerId="Trainer has a conflicting session at this time"),x(t),Object.keys(t).length===0},u=(t,n="success")=>{T({message:t,type:n}),setTimeout(()=>T(null),3e3)},k=async t=>{if(t.preventDefault(),!!C()){N(!0);try{if(i)p({type:b.UPDATE_SESSION,payload:{...s,id:i.id,status:i.status}}),u("Session updated successfully!");else{const m=new Date(`${s.date}T${s.startTime}`)>new Date?"upcoming":"completed";p({type:b.ADD_SESSION,payload:{...s,status:m}}),u("Session scheduled successfully!")}l(!1),c()}catch{u("An error occurred. Please try again.","error")}finally{N(!1)}}},$=t=>{window.confirm("Delete this session?")&&(p({type:b.DELETE_SESSION,payload:t}),u("Session deleted successfully!"))},h=t=>{const{name:n,value:m}=t.target;o({...s,[n]:m}),a[n]&&x({...a,[n]:""})},g=[...S].sort((t,n)=>new Date(n.date)-new Date(t.date));return e.jsxs("div",{className:"space-y-4",children:[f&&e.jsx("div",{className:`fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ${f.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:f.message}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Sessions"}),e.jsx("button",{onClick:D,className:"btn btn-primary",children:"Schedule Session"})]}),g.length===0?e.jsx("p",{className:"text-center py-8 text-gray-500",children:"No sessions scheduled"}):e.jsx("div",{className:"space-y-2",children:g.map(t=>{const n=v(t.trainerId),m=((new Date(`2000-01-01T${t.endTime}`)-new Date(`2000-01-01T${t.startTime}`))/(1e3*60*60)).toFixed(1);return e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600",children:(n==null?void 0:n.name)||"Unknown Trainer"})]}),e.jsx("span",{className:`badge ${t.status==="upcoming"?"badge-success":"badge-default"}`,children:t.status})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:[t.date," • ",t.startTime," - ",t.endTime," (",m,"h)"]}),e.jsxs("p",{className:"text-xs text-gray-500 mb-3",children:["Skill: ",(n==null?void 0:n.skill)||"N/A"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>E(t),className:"btn btn-outline btn-sm w-20",children:"Edit"}),e.jsx("button",{onClick:()=>$(t.id),className:"btn btn-danger btn-sm w-20",children:"Delete"})]})]},t.id)})}),w&&e.jsx("div",{className:"modal-overlay",onClick:()=>{l(!1),c()},children:e.jsxs("div",{className:"modal-panel",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("span",{className:"font-semibold",children:i?"Edit Session":"Schedule Session"}),e.jsx("button",{className:"text-slate-600",onClick:()=>{l(!1),c()},children:"×"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("form",{onSubmit:k,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Session Name"}),e.jsx("input",{type:"text",name:"name",value:s.name,onChange:h,className:`w-full px-3 py-2 border rounded-lg ${a.name?"border-red-500":""}`,disabled:d}),a.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Trainer"}),e.jsxs("select",{value:s.trainerId,onChange:t=>{o({...s,trainerId:t.target.value}),a.trainerId&&x({...a,trainerId:""})},className:`w-full px-3 py-2 border rounded-lg ${a.trainerId?"border-red-500":""}`,disabled:d,children:[e.jsx("option",{value:"",children:"Select trainer..."}),y.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),a.trainerId&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.trainerId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Date"}),e.jsx("input",{type:"date",name:"date",value:s.date,onChange:h,className:`w-full px-3 py-2 border rounded-lg ${a.date?"border-red-500":""}`,disabled:d}),a.date&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.date})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Start Time"}),e.jsx("input",{type:"time",name:"startTime",value:s.startTime,onChange:h,className:`w-full px-3 py-2 border rounded-lg ${a.startTime?"border-red-500":""}`,disabled:d}),a.startTime&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.startTime})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"End Time"}),e.jsx("input",{type:"time",name:"endTime",value:s.endTime,onChange:h,className:`w-full px-3 py-2 border rounded-lg ${a.endTime?"border-red-500":""}`,disabled:d}),a.endTime&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.endTime})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"button",className:"btn btn-outline flex-1",onClick:()=>{l(!1),c()},disabled:d,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary flex-1",disabled:d,children:d?"Saving...":i?"Update":"Schedule"})]})]})})]})})]})};export{q as default};
