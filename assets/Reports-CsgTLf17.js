import{a as D,r as h,j as e}from"./index-DNxpbptG.js";const A=()=>{const{trainers:j,attendance:g,getTrainerById:y,getSessionById:f}=D(),[i,N]=h.useState(""),[x,b]=h.useState(""),[m,v]=h.useState(""),w=t=>{const s=g.filter(a=>a.trainerId===t),u=s.reduce((a,n)=>a+parseFloat(n.workingHours||0),0),d=s.filter(a=>a.status==="Present").length,p=s.filter(a=>a.status==="Late").length,o=s.filter(a=>a.status==="Missed").length,l=s.length;return{totalHours:u.toFixed(2),presentCount:d,lateCount:p,missedCount:o,totalSessions:l,attendanceRate:l>0?(d/l*100).toFixed(1):0}},r=g.filter(t=>{const s=f(t.sessionId);return!(!s||i&&t.trainerId!==i||x&&s.date<x||m&&s.date>m)}),k=r.reduce((t,s)=>t+parseFloat(s.workingHours||0),0),S=r.filter(t=>t.status==="Present").length,C=r.filter(t=>t.status==="Late").length,T=r.filter(t=>t.status==="Missed").length,I=()=>{const t=r.map(a=>{const n=y(a.trainerId),c=f(a.sessionId);return{Trainer:n==null?void 0:n.name,EmployeeID:n==null?void 0:n.employeeId,Session:c==null?void 0:c.name,Date:c==null?void 0:c.date,CheckIn:a.checkInTime?new Date(a.checkInTime).toLocaleString():"N/A",CheckOut:a.checkOutTime?new Date(a.checkOutTime).toLocaleString():"N/A",Hours:a.workingHours||0,Status:a.status,Approved:a.approved?"Yes":"No"}}),s=Object.keys(t[0]||{}).join(","),u=t.map(a=>Object.values(a).join(",")).join(`
`),d=`${s}
${u}`,p=new Blob([d],{type:"text/csv"}),o=window.URL.createObjectURL(p),l=document.createElement("a");l.href=o,l.download=`attendance_report_${new Date().toISOString().split("T")[0]}.csv`,l.click(),window.URL.revokeObjectURL(o)};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Reports"}),e.jsxs("div",{className:"card p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Filters"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Trainer"}),e.jsxs("select",{value:i,onChange:t=>N(t.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[e.jsx("option",{value:"",children:"All Trainers"}),j.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:x,onChange:t=>b(t.target.value),className:"w-full px-3 py-2 border rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:m,onChange:t=>v(t.target.value),className:"w-full px-3 py-2 border rounded-lg"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{N(""),b(""),v("")},className:"btn btn-outline flex-1",children:"Clear"}),e.jsx("button",{onClick:I,className:"btn btn-success flex-1",children:"Export CSV"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[e.jsxs("div",{className:"card p-3 text-center",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Total Hours"}),e.jsx("p",{className:"text-2xl font-bold",children:k.toFixed(1)})]}),e.jsxs("div",{className:"card p-3 text-center",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Present"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:S})]}),e.jsxs("div",{className:"card p-3 text-center",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Late"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:C})]}),e.jsxs("div",{className:"card p-3 text-center",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Missed"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:T})]})]}),r.length===0?e.jsx("p",{className:"text-center py-8 text-gray-500",children:"No records"}):e.jsxs("div",{className:"card p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Trainer Reports"}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:j.filter(t=>!i||t.id===i).map(t=>{const s=w(t.id);return s.totalSessions===0?null:e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:t.name}),e.jsx("p",{className:"text-xs text-gray-600",children:t.skill})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("p",{className:"font-semibold",children:[s.attendanceRate,"% Rate"]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[s.totalHours,"h worked"]})]})]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Sessions: ",s.presentCount,"P + ",s.lateCount,"L +"," ",s.missedCount,"M = ",s.totalSessions,"T"]})]},t.id)})})]})]})};export{A as default};
