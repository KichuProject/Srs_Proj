import{a as C,r as h,j as s}from"./index-DNxpbptG.js";const A=()=>{const{sessions:j,trainers:f,attendance:d,dispatchAttendance:o,ATTENDANCE_ACTIONS:m,getTrainerById:N,getSessionById:g}=C(),[i,x]=h.useState(""),[r,u]=h.useState(""),[l,c]=h.useState({}),[p,b]=h.useState(null),n=(e,t="success")=>{b({message:e,type:t}),setTimeout(()=>b(null),3e3)},T=()=>{if(c({}),!i){c({session:"Please select a session"}),n("Please select a session","error");return}if(!r){c({trainer:"Please select a trainer"}),n("Please select a trainer","error");return}const e=d.find(a=>a.sessionId===i&&a.trainerId===r);if(e!=null&&e.checkInTime){n("Already checked in for this session","error");return}const t=g(i);o({type:m.CHECK_IN,payload:{sessionId:i,trainerId:r,timestamp:new Date().toISOString(),sessionStartTime:`${t.date}T${t.startTime}:00`,sessionEndTime:`${t.date}T${t.endTime}:00`}}),n("Checked in successfully!"),x(""),u("")},v=()=>{if(c({}),!i){c({session:"Please select a session"}),n("Please select a session","error");return}if(!r){c({trainer:"Please select a trainer"}),n("Please select a trainer","error");return}const e=d.find(t=>t.sessionId===i&&t.trainerId===r);if(!(e!=null&&e.checkInTime)){n("Must check in before checking out","error");return}if(e.checkOutTime){n("Already checked out for this session","error");return}o({type:m.CHECK_OUT,payload:{sessionId:i,trainerId:r,timestamp:new Date().toISOString()}}),n("Checked out successfully!"),x(""),u("")},k=e=>{const t={Present:"badge-success",Late:"badge-warning",Missed:"badge-danger",Rejected:"badge-danger"};return s.jsx("span",{className:`badge ${t[e]||"badge-default"}`,children:e})},y=e=>{o({type:m.APPROVE_ATTENDANCE,payload:e}),n("Attendance approved!")},I=e=>{window.confirm("Reject this record?")&&(o({type:m.REJECT_ATTENDANCE,payload:e}),n("Attendance rejected!"))};return s.jsxs("div",{className:"space-y-4",children:[p&&s.jsx("div",{className:`fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ${p.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:p.message}),s.jsx("h1",{className:"text-3xl font-bold",children:"Attendance"}),s.jsxs("div",{className:"card p-4",children:[s.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Check-In / Check-Out"}),s.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Session"}),s.jsxs("select",{value:i,onChange:e=>{x(e.target.value),l.session&&c({...l,session:""})},className:`w-full px-3 py-2 border rounded-lg ${l.session?"border-red-500":""}`,children:[s.jsx("option",{value:"",children:"Select Session"}),j.map(e=>s.jsxs("option",{value:e.id,children:[e.name," - ",e.date]},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Trainer"}),s.jsxs("select",{value:r,onChange:e=>{u(e.target.value),l.trainer&&c({...l,trainer:""})},className:`w-full px-3 py-2 border rounded-lg ${l.trainer?"border-red-500":""}`,children:[s.jsx("option",{value:"",children:"Select Trainer"}),f.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:T,className:"btn btn-success flex-1",children:"Check In"}),s.jsx("button",{onClick:v,className:"btn btn-danger flex-1",children:"Check Out"})]})]}),s.jsxs("div",{className:"card p-4",children:[s.jsx("h2",{className:"text-lg font-bold mb-3",children:"Attendance History"}),d.length===0?s.jsx("p",{className:"text-center py-6 text-gray-500",children:"No records"}):s.jsx("div",{className:"space-y-2",children:d.map(e=>{const t=N(e.trainerId),a=g(e.sessionId);return s.jsxs("div",{className:"border rounded-lg p-3",children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsxs("div",{children:[s.jsxs("p",{className:"font-semibold",children:[t==null?void 0:t.name," - ",a==null?void 0:a.name]}),s.jsx("p",{className:"text-sm text-gray-600",children:a==null?void 0:a.date})]}),s.jsxs("div",{className:"flex flex-col gap-1",children:[k(e.status),s.jsxs("div",{className:"flex gap-1",children:[!e.approved&&e.status!=="Rejected"&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>y(e.id),className:"btn btn-success btn-sm text-xs",children:"Approve"}),s.jsx("button",{onClick:()=>I(e.id),className:"btn btn-danger btn-sm text-xs",children:"Reject"})]}),e.approved&&s.jsx("span",{className:"badge badge-success text-xs",children:"Approved"})]})]})]}),s.jsxs("p",{className:"text-xs text-gray-600 mb-2",children:["In:"," ",e.checkInTime?new Date(e.checkInTime).toLocaleTimeString():"-"," ","| Out:"," ",e.checkOutTime?new Date(e.checkOutTime).toLocaleTimeString():"-"," ","| ",e.workingHours||0,"h"]})]},e.id)})})]})]})};export{A as default};
